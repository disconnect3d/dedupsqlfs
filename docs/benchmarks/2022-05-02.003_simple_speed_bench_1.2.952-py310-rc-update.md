# Простые тесты скорости работы DedupSQLfs v1.2.952 за 02.05.2022

1. Проверка обновления модуля recordclass до 0.17.2.
2. Проверка влияния наличия или отсутствия модуля recordclass.
3. Потребление памяти.

Распаковка LibreOffice 6.4.7, 7.1.8, 7.2.7, 7.3.3

Проверка работы на движке: sqlite 3.38.2

CPU: i5-6600K @ 3.50GHz

System: Ubuntu 18.04 amd64

Kernel: 5.4.0-104-lowlatency

Python: 3.10.4

Размер LibreOffice в tar:

* 6.4.7 - 1133M
* 7.1.8 - 1184M
* 7.2.7 - 1204M
* 7.3.3 - 1213M

Другое: включен autocommit, выключен sync, hash=md5, режим=однопоточный

Команда:
```sh
/usr/bin/time -v python3.10 ./mount.dedupsqlfs -vv --verbose-stats --data $HOME/Temp/sqlfs/data/ --compress lz4 --no-sync --no-cache-flusher --minimal-compress-size -1 -o noatime $HOME/Temp/sqlfs/mount
```

Извлечение LO:
```sh
tar xf {libre-tar} -C $HOME/Temp/sqlfs/mount && sudo umount $HOME/Temp/sqlfs/mount
```

Извлечение происходило без стирания предыдущих копий libreoffice. Тестировалась в том числе и дедупликация.

Тестировался только метод LZ4:

* none
* lz4

## Тесты

| LO ver   || 6.4.7 ||| 7.1.8 ||| 7.2.7 ||| 7.3.3 ||
|----------|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|
| **method** | **time** | **memory** | **speed** | **time** | **memory** | **speed** | **time** | **memory** | **speed** | **time** | **memory** | **speed** |
| lz4      | 1:39.83 | 445 | 31.98 | 1:36.65 | 295 | 42.05 | 1:33.58 | 303 | 40.76 | 1:35.85 | 427 | 48.65 |

Для сравнения: однопоточные для python-3.10 + recordclass 0.14.3
| LO ver   || 6.4.7 ||| 7.1.8 ||| 7.2.7 ||| 7.3.3 ||
|----------|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|
| **method** | **time** | **memory** | **speed** | **time** | **memory** | **speed** | **time** | **memory** | **speed** | **time** | **memory** | **speed** |
| lz4      | 1:41.89 | 413 | 36.63 | 1:34.62 | 311 | 34.09 | 1:33.15 | 303 | 41.26 | 1:35.91 | 304 | 43.29 |
| lz4 noRC | 1:41.51 | 354 | 31.31 | 1:35.43 | 418 | 40.01 | 1:35.18 | 295 | 41.33 | 1:31.90 | 304 | 39.79 |

* :time   - время работы dedupsqlfs, в том числе и umount
* :memory - размер в памяти, согласно отладке в time, max resident size MiB
* :speed  - показатели отладки dedupsqlfs по скорости записи данных, MiB/s

## Результат

Просто посмотреть и сравнить обновление версии модуля. И сколько памяти тратится.

- ничего сильно не изменилось, или тесты не сильно аккуратные
