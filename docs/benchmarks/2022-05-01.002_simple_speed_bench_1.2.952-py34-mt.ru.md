# Простые тесты скорости работы DedupSQLfs v1.2.952 с разными методами сжатия

Распаковка LibreOffice 6.4.7, 7.1.8, 7.2.7, 7.3.3

Проверка работы на движке: sqlite 3.38.2

CPU: i5-6600K @ 3.50GHz

System: Ubuntu 18.04 amd64

Kernel: 5.4.0-104-lowlatency

Python: 3.4.10

Размер LibreOffice в tar:

* 6.4.7 - 1133M
* 7.1.8 - 1184M
* 7.2.7 - 1204M
* 7.3.3 - 1213M

Другое: включен autocommit, выключен sync, hash=md5, режим=многопоточный (4x)

Команда:
```sh
/usr/bin/time -v python3.4 ./mount.dedupsqlfs -vv --verbose-stats --data $HOME/Temp/sqlfs/data/ --compress {method} --no-sync --no-cache-flusher --minimal-compress-size -1 --multi-cpu thread -o noatime $HOME/Temp/sqlfs/mount
```

Извлечение LO:
```sh
tar xf {libre-tar} -C $HOME/Temp/sqlfs/mount && sudo umount $HOME/Temp/sqlfs/mount
```

Извлечение происходило без стирания предыдущих копий libreoffice. Тестировалась в том числе и дедупликация.

Тестировались только быстрые методы:

* none
* zstd:1
* brotli:0
* zstd:1 + brotli:0

## Тесты

| LO ver   || 6.4.7 ||| 7.1.8 ||| 7.2.7 ||| 7.3.3 ||
|----------|:----:|:----:|:-----:|:----:|:----:|:-----:|:----:|-----:|:-----:|:----:|:----:|:-----:|
| **method** | **time** | **size** | **speed** | **time** | **size** | **speed** | **time** | **size** | **speed** | **time** | **size** | **speed** |
| none     | 1:54.40 | 1095M | 24.49 | 1:53.76 | 1646M | 30.25 | 1:53.92 | 2076M | 33.87 | 1:52.51 | 2477M | 31.84 |
| zstd:1   | 2:01.52 | 422M | 28.22 | 1:56.56 | 612M | 28.35 | 1:53.94 | 749M | 31.57 | 1:50.99 | 873M | 30.93 |
| brotli:0 | 1:59.58 | 450M | 20.51 | 1:53.76 | 657M | 30.09 | 1:49.11 | 806M | 34.46 | 1:53.11 | 942M | 31.77 |
| zstd:1<br>+<br>brotli:0 | 2:03.58 | 422M | 23.59 | 1:55.56 | 612M | 30.48 | 1:53.87 | 749M | 32.53 | 1:53.84 | 873M | 33.91 |

Для сравнения: предыдущие однопоточные
| LO ver   || 6.4.7 ||| 7.1.8 ||| 7.2.7 ||| 7.3.3 ||
|----------|:----:|:----:|:-----:|:----:|:----:|:-----:|:----:|-----:|:-----:|:----:|:----:|:-----:|
| **method** | **time** | **size** | **speed** | **time** | **size** | **speed** | **time** | **size** | **speed** | **time** | **size** | **speed** |
| none     | 1:56.79 | 1095M | 27.98 | 1:59.22 | 1646M | 30.73 | 1:54.59 | 2076M | 40.14 | 1:51.22 | 2477M | 35.29 |
| zstd:1   | 1:58.26 | 420M | 23.95 | 1:53.89 | 609M | 32.20 | 1:50.66 | 746M | 32.24 | 1:51.19 | 869M | 32.10 |
| brotli:0 | 2:03.32 | 448M | 23.01 | 1:58.40 | 654M | 30.37 | 1:52.02 | 804M | 37.62 | 1:54.36 | 939M | 36.82 |
| zstd:1<br>+<br>brotli:0 | 2:06.67 | 420M | 24.75 | 1:56.79 | 609M | 27.77 | 1:55.11 | 746M | 36.55 | 1:53.01 | 870M | 30.54 |

* :time  - время работы dedupsqlfs, в том числе и umount
* :size  - размер итоговых данных в ~/Temp/sqlfs/data/, MiB
* :speed - показатели отладки dedupsqlfs по скорости записи данных, MiB/s

## Результат

Просто посмотреть и сравнить с однопоточным.

- в среднем, время работы уменьшилось,
- правда и скорость тоже
- при этом резмер данных увеличился
- по наблюдениям в htop - многопоточность работает слабо
